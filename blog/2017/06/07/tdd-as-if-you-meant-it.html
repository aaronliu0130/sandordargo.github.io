<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="TDD as if you meant it" /><meta property="og:locale" content="en_US" /><meta name="description" content="The kata we picked was TDD as if you meant it. The rules are the ones of TDD, plus some additionals. These rules - such as write the code first at the test class and don’t move it until… - are not so complicated. However you might end up using quite some time thinking about whether you are playing by the rules…" /><meta property="og:description" content="The kata we picked was TDD as if you meant it. The rules are the ones of TDD, plus some additionals. These rules - such as write the code first at the test class and don’t move it until… - are not so complicated. However you might end up using quite some time thinking about whether you are playing by the rules…" /><link rel="canonical" href="https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it" /><meta property="og:url" content="https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-06-07T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TDD as if you meant it" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-06-23T13:24:55+02:00","datePublished":"2017-06-07T00:00:00+02:00","description":"The kata we picked was TDD as if you meant it. The rules are the ones of TDD, plus some additionals. These rules - such as write the code first at the test class and don’t move it until… - are not so complicated. However you might end up using quite some time thinking about whether you are playing by the rules…","headline":"TDD as if you meant it","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it"},"url":"https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it"}</script><title>TDD as if you meant it | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2017"> 2017 </a> </span> <span> <a href="/06"> 06 </a> </span> <span> <a href="/07"> 07 </a> </span> <span>TDD as if you meant it</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>TDD as if you meant it</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 7, 2017, 12:00 AM +0200" prep="on" > Jun 7, 2017 <i class="unloaded">2017-06-07T00:00:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 23, 2020, 1:24 PM +0200" prefix="Updated " > Jun 23, 2020 <i class="unloaded">2020-06-23T13:24:55+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1575 words">8 min</span></div></div><div class="post-content"><p>The kata we picked was <a href="http://coderetreat.org/facilitating/activities/tdd-as-if-you-meant-it">TDD as if you meant it</a>. The rules are the ones of TDD, plus some additionals. These rules - such as write the code first at the test class and don’t move it until… - are not so complicated. However you might end up using quite some time thinking about whether you are playing by the rules…</p><p>As I’m sure you observed, <a href="http://coderetreat.org/facilitating/activities/tdd-as-if-you-meant-it">TDD as if you meant it</a> doesn’t give you a specific programming problem to solve. So in fact we had to pick another kata as well. We wanted to choose something simple, something we know. We picked the <a href="https://github.com/emilybache/DiamondKata">Diamond kata</a>.</p><p>The first tests seemed pretty lame.</p><p><code class="language-plaintext highlighter-rouge">ASSERT_EQ("A\n", diamond(1));</code></p><p>The production code simply returned “A”.</p><p><code class="language-plaintext highlighter-rouge">ASSERT_EQ(" A \nB B\n A \n", diamond(2));</code></p><p>I forgot to mention I paired with a highly experienced architect of our company.</p><p>So the prodcution code was still dead stupid as that was the least amount of code necessary to past the test.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    if (size == 1)
        return "A\n";
    if (size == 2)
        return " A \nB B\n A \n";
}
</pre></table></code></div></div><p>As we put on our blue hat for refactoring, he asked me if I see the duplication. The what? Come on, why don’t we implement a normal algorithm here? But no. Still the repetition…. Well… We do return twice, but…</p><p>I was told to ignore refactoring for a moment, and let’s just stupidly sketch up the next test with some hardcoded responses.</p><p>Well… Why not…</p><p><code class="language-plaintext highlighter-rouge">ASSERT_EQ(" A \n B B \nC C\n B B \n A \n", diamond(3));</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    if (size == 1)
        return "A\n";
    if (size == 2)
        return " A \nB B\n A \n";
    if (size == 3)
        return "  A  \n B B \nC   C\n B B \n  A  \n";
}
</pre></table></code></div></div><p>Okay, not let’s change a bit the outline of this function:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>std::string diamond(size_t iSize) {
    if (iSize == 1)
        return "A\n";
    if (iSize == 2)
        return " A \n"\
               "B B\n"\
               " A \n";
    if (iSize == 3)
        return "  A  \n"\
               " B B \n"\
               "C   C\n"\
               " B B \n"\
               "  A  \n";
}
</pre></table></code></div></div><p>Do you see it now, Luke? To be frank, I would have already implemented the algorithm… I was trained on <a href="https://www.codingame.com/multiplayer/clashofcode">fastest mode code clashes</a>… I don’t say it is a virtue, but I usually take bigger leaps. This time though let’s make some baby steps.</p><p>We started to implement functions such as:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>std::string makeALineSizeOf1() {
    return "A\n"
}

std::string makeALineSizeOf2() {
    return " A \n"
}

std::string makeBLineSizeOf2() {
    return "B B\n"
}
</pre></table></code></div></div><p>So at that time our diamond function would have been something like this:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    if (size == 1)
        return makeALineSizeOf1();
    if (size == 2)
        return "makeALineSizeOf2() +
               "makeBLineSizeOf2() +
               "makeALineSizeOf2();
    if (size == 3)
        return "makeALineSizeOf3() +
               "makeBLineSizeOf3() +
               "makeCLineSizeOf3() +
               "makeBLineSizeOf3() +
               "makeALineSizeOf3();
}
</pre></table></code></div></div><p>Time to generalize it a bit. But don’t move too fast!</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>std::string makeALineSizeOf(size_t size) {
    std::stringstream ss;
    ss &lt;&lt; std::string(size - 1, ' ') &lt;&lt; 'A' &lt;&lt; std::string(size - 1, ' ');
    return ss.toStr();
}

std::string makeBLineSizeOf(size_t size) {
    std::stringstream ss;
    ss &lt;&lt; std::string(size - 2, ' ') &lt;&lt; 'B' &lt;&lt; ' ' &lt;&lt; 'B' &lt;&lt; std::string(size - 2, ' ');
    return ss.toStr();
}

std::string makeCLineSizeOf(size_t size) {
    std::stringstream ss;
    ss &lt;&lt; std::string(size - 3, ' ') &lt;&lt; 'C' &lt;&lt; '   ' &lt;&lt; 'C' &lt;&lt; std::string(size - 3, ' ');
    return ss.toStr();
}
</pre></table></code></div></div><p>Then our diamond function looks like:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    if (size == 1)
        return makeALineSizeOf(1);
    if (size == 2)
        return makeALineSizeOf(2) +
               makeBLineSizeOf(2) +
               makeALineSizeOf(2);
    if (size == 3)
        return makeALineSizeOf(3) +
               makeBLineSizeOf(3) +
               makeCLineSizeOf(3) +
               makeBLineSizeOf(3) +
               makeALineSizeOf(3);
}
</pre></table></code></div></div><p>You start to see how it goes. By the time we reached this point our time was up, we had to return to our offices. So now it is time to finish up the algorithm:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>std::string makeLineOfCharacterSizeOf(char character, size_t size) {
    std::stringstream ss;
    ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; character &lt;&lt; std::string(1 + 2*int(character - 'B')) &lt;&lt; character &lt;&lt;  std::string(size - (character - 'A' + 1), ' ');
    return ss.str();
}
</pre></table></code></div></div><p>Then the diamond is:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    if (size == 1)
        return makeALineSizeOf(1);
    if (size == 2)
        return makeALineSizeOf(2) +
               makeLineOfCharacterSizeOf('B', 2) +
               makeALineSizeOf(2);
    if (size == 3)
        return makeALineSizeOf(3) +
               makeLineOfCharacterSizeOf('B', 3) +
               makeLineOfCharacterSizeOf('C', 3) +
               makeLineOfCharacterSizeOf('B', 3) +
               makeALineSizeOf(3);
}
</pre></table></code></div></div><p>We still have a problem with ‘A’-s. But that’s fine, we can have an if in our makeLineOfCharacterSizeOf():</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>std::string makeLineOfCharacterSizeOf(char character, size_t size) {
    std::stringstream ss;
    if (character == 'A') {
        ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; character &lt;&lt; std::string(size - (character - 'A' + 1), ' ');
    } else {
        ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; character &lt;&lt; std::string(1 + 2*int(character - 'B')), ' ') &lt;&lt; character &lt;&lt;  std::string(size - (character - 'A' + 1), ' ');
    }
    return ss.str();
}
</pre></table></code></div></div><p>There are some duplications but we’ll get back to that later.</p><p>Let’s go back to diamond which looks like this now:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    if (size == 1)
        return makeLineOfCharacterSizeOf('A', 1);
    if (size == 2)
        return makeLineOfCharacterSizeOf('A', 2) +
               makeLineOfCharacterSizeOf('B', 2) +
               makeLineOfCharacterSizeOf('A', 2);
    if (size == 3)
        return makeLineOfCharacterSizeOf('A', 3) +
               makeLineOfCharacterSizeOf('B', 3) +
               makeLineOfCharacterSizeOf('C', 3) +
               makeLineOfCharacterSizeOf('B', 3) +
               makeLineOfCharacterSizeOf('A', 3);
}
</pre></table></code></div></div><p>Finish it! If you remember Mortal Kombat…</p><p>Add a new failing test case:</p><p><code class="language-plaintext highlighter-rouge">ASSERT_EQ(" A \n B B \n C C \nD D\n C C \n B B \n A \n", diamond(4));</code></p><p>If you understand the pattern, you can see that first you have to add some lines starting from A. Then you add the middle line of the diamond which will appear only once. Then you add the lines you already added in the first phase, but now in reverse order.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    std::stringstream ss;
    for(int i=0; i&lt;size-1; ++i) {
        ss &lt;&lt; makeLineOfCharacterSizeOf('A'+i, size);
    }
    ss &lt;&lt; makeLineOfCharacterSizeOf('A'+size-1, size);
    for(int i=size-2; i&gt;=0; --i) {
        ss &lt;&lt; makeLineOfCharacterSizeOf('A'+i, size);
    }
    return ss.str();
}
</pre></table></code></div></div><p>We are almost done! Let’s put on that blue hat again and start refactoring! First get rid off all those stringsteam to string conversions, except for the last one and pass the stringstream around.</p><p>A bit simpler now:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>std::string diamond(size_t size) {
    std::stringstream ss;
    for(int i=0; i&lt;size-1; ++i) {
        makeLineOfCharacterSizeOf('A'+i, size, ss);
    }
    makeLineOfCharacterSizeOf('A'+size-1, size, ss);
    for(int i=size-2; i&gt;=0; --i) {
        makeLineOfCharacterSizeOf('A'+i, size, ss);
    }
    return ss.str();
}

void makeLineOfCharacterSizeOf(char character, size_t size, std::stringstream&amp; ss) {
    if (character == 'A') {
        ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; character &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; "\n";
    } else {
    ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; character &lt;&lt; std::string(1 + 2 * int(character - 'B'), ' ') &lt;&lt; character &lt;&lt;  std::string(size - (character - 'A' + 1), ' ') &lt;&lt; "\n";
    }
}
</pre></table></code></div></div><p>There are still some duplications though, and makeLineOfCharacterSizeOf is not so readable. So let’s improve it!</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>void makeLineOfCharacterSizeOf(char character, size_t size, std::stringstream&amp; ss) {
    ss  &lt;&lt; std::string(size - (character - 'A' + 1), ' ');
    if (character == 'A') {
        ss &lt;&lt; character;
    } else {
        ss &lt;&lt; character &lt;&lt; std::string(1 + 2 * int(character - 'B'), ' ') &lt;&lt; character;
    }
    ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ') &lt;&lt; "\n";
}
</pre></table></code></div></div><p>Seems better, right? I think so. Let’s move forward and even change some function names.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>std::string drawSizeOf(size_t size) {
    std::stringstream ss;
    for(int i=0; i&lt;size-1; ++i) {
        addLineOfCharacterSizeOf('A'+i, size, ss);
    }
    addLineOfCharacterSizeOf('A'+size-1, size, ss);
    for(int i=size-2; i&gt;=0; --i) {
        addLineOfCharacterSizeOf('A'+i, size, ss);
    }
    return ss.str();
}

void Diamond::addLineOfCharacterSizeOf(char character, size_t size, std::stringstream&amp; ss) {
    addEdgeSpaces(character, size, ss);
    addCharacter(character, ss);
    if (character != 'A') {
        addMiddleSpaces(character, size, ss);
        addCharacter(character, ss);
    }
    addEdgeSpaces(character, size, ss);
    addNewLine(ss);
}

void Diamond::addCharacter(char character, std::stringstream&amp; ss) {
    ss &lt;&lt; character;
}
void Diamond::addEdgeSpaces(char character, size_t size, std::stringstream&amp; ss) {
    ss &lt;&lt; std::string(size - (character - 'A' + 1), ' ');
}

void Diamond::addMiddleSpaces(char character, size_t size, std::stringstream&amp; ss) {
    ss &lt;&lt; std::string(1 + 2 * int(character - 'B'), ' ');
}

void Diamond::addNewLine(std::stringstream&amp; ss) {
    ss &lt;&lt; "\n";
}
</pre></table></code></div></div><p>It’s a bit lengthy but it is way much cleaner.</p><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tdd/" class="post-tag no-text-decoration" >tdd</a> <a href="/tags/kata/" class="post-tag no-text-decoration" >kata</a> <a href="/tags/dojo/" class="post-tag no-text-decoration" >dojo</a> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/learning/" class="post-tag no-text-decoration" >learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=TDD as if you meant it - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=TDD as if you meant it - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=TDD as if you meant it - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=TDD as if you meant it - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2021/06/16/multiple-destructors-with-cpp-concepts">Multiple destructors with C++ concepts</a><li><a href="/blog/2021/03/17/write-your-own-cpp-concepts-part-ii">How to write your own C++ concepts? Part II.</a><li><a href="/blog/2024/01/31/cpp23-likes-to-move-it">C++23 likes to move it!</a><li><a href="/blog/2024/01/03/DR20-equality-operator">DR20 - The Equality Operator You Are Looking For</a><li><a href="/blog/2023/12/06/cpp23-strtream-strstream-replacement">C++23: The rise of new streams</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/management/">management</a> <a class="post-tag" href="/tags/philosophy/">philosophy</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2018/08/08/gilded-rose-revisited"><div class="card-body"> <span class="timeago small" > Aug 8, 2018 <i class="unloaded">2018-08-08T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gilded Rose kata revisited</h3><div class="text-muted small"><p> If you are into coding dojos and solving katas, you might have already tried the Gilded Rose kata by Emily Bache. In this kata, you are given some existing code that handles the quality and the nu...</p></div></div></a></div><div class="card"> <a href="/blog/2018/08/29/deliberate-practice-and-memory-management"><div class="card-body"> <span class="timeago small" > Aug 29, 2018 <i class="unloaded">2018-08-29T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deliberate practice and memory management</h3><div class="text-muted small"><p> I have recently read the eye-opening book of Cal Newport, So Good They Can’t Ignore You. He emphasizes a lot on the importance of deliberate practice. I also decided to take a bit more seriously my...</p></div></div></a></div><div class="card"> <a href="/blog/2020/12/19/santas-christmas-wishlist"><div class="card-body"> <span class="timeago small" > Dec 19, 2020 <i class="unloaded">2020-12-19T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Santa's Christmas Wishlist</h3><div class="text-muted small"><p> Christmas is coming, and I created a small coding exercise for you that focuses on Object-Oriented Design and delivering presents every to child! The code kata is called Santas’s Christmas Wishlis...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2017/05/16/attending-my-first-it-conference" class="btn btn-outline-primary" prompt="Older"><p>Attending my first IT conference</p></a> <a href="/blog/2017/06/09/4hww" class="btn btn-outline-primary" prompt="Newer"><p>4 Hours Work Week by Timothy Ferriss</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'TDD as if you meant it'; this.page.url = 'https://www.sandordargo.com/blog/2017/06/07/tdd-as-if-you-meant-it'; this.page.identifier = '/blog/2017/06/07/tdd-as-if-you-meant-it'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/management/">management</a> <a class="post-tag" href="/tags/philosophy/">philosophy</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
