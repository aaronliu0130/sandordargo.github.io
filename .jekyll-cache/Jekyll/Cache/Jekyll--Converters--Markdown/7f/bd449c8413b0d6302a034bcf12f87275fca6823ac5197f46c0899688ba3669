I"F"<p><em>Just make everything <code class="language-plaintext highlighter-rouge">const</code> that you can! That’s the bare minimum you could do for your compiler!</em></p>

<p>This is a piece of advice, many <em>senior</em> developers tend to repeat to juniors, while so often even the preaching ones - we - fail to follow this rule.
<!--more--></p>

<p>It’s so easy just to declare a variable without making it <code class="language-plaintext highlighter-rouge">const</code>, even though we know that its value should never change. Of course, our compiler doesn’t know it.</p>

<p>It’s not enough that we fail to comply with our own recommendations, we are also not specific enough. So if others just blindly follow our recommendations without much thinking, then it just messes things up. Compilation failures are easy to spot early on, but dangling references or worse performance due to extra copies are more difficult to identify. Hopefully, those are caught not later than <a href="https://www.sandordargo.com/blog/2018/03/28/codereview-guidelines">the code review</a>.</p>

<p>But don’t be mad at the people following your words blindly. If you share pieces of advice without much thinking if you don’t expect critical thinking from yourself, why would you expect more from others?</p>

<p>I digressed, let’s get back to our topic. So what kind of <code class="language-plaintext highlighter-rouge">const</code>s are out there?</p>

<p>In this series of articles, we’ll discuss about:
In this series of articles, we discuss about:</p>
<ul>
  <li><a href="https://www.sandordargo.com/blog/2020/11/04/when-use-const-1-functions-local-variables"><code class="language-plaintext highlighter-rouge">const</code> functions</a></li>
  <li><a href="https://www.sandordargo.com/blog/2020/11/04/when-use-const-1-functions-local-variables"><code class="language-plaintext highlighter-rouge">const</code> local variables</a></li>
  <li><a href="https://www.sandordargo.com/blog/2020/11/11/when-use-const-2-member-variables"><code class="language-plaintext highlighter-rouge">const</code> member variables</a></li>
  <li><a href="https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types"><code class="language-plaintext highlighter-rouge">const</code> return types</a></li>
  <li><a href="https://www.sandordargo.com/blog/2020/11/25/when-use-const-4-parameters"><code class="language-plaintext highlighter-rouge">const</code> parameters</a></li>
</ul>

<p>In this post, we are going to explore const functions and const local variables.</p>

<p>Let’s get started.</p>

<h2 id="const-functions"><code class="language-plaintext highlighter-rouge">const</code> functions</h2>
<p>You can declare a non-static member function <code class="language-plaintext highlighter-rouge">const</code> if it doesn’t change the value of the underlying object. This is recursive in a sense, that it cannot modify any of the members. To guarantee that, it cannot call non-const functions on its members.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td> --><td class="rouge-code"><pre><span class="cp">#include &lt;iostream&gt;
</span>
<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
<span class="err"> </span> <span class="k">public</span><span class="o">:</span>
<span class="err"> </span> <span class="kt">void</span> <span class="n">bar</span><span class="p">()</span> <span class="p">{</span>
<span class="err"> </span> <span class="c1">// ...</span>
<span class="err"> </span> <span class="p">}</span> 
<span class="p">};</span>

<span class="k">class</span> <span class="nc">B</span> <span class="p">{</span>
<span class="nl">public:</span>
<span class="err"> </span> <span class="kt">void</span> <span class="n">foo</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">a</span><span class="p">.</span><span class="n">bar</span><span class="p">();</span> <span class="c1">// A::bar() is not const, so this call generates a compilation error!</span>
<span class="err"> </span> <span class="p">}</span>
<span class="nl">private:</span>
<span class="err"> </span><span class="n">A</span> <span class="n">a</span><span class="p">{};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="err"> </span> <span class="k">auto</span> <span class="n">b</span><span class="p">{</span><span class="n">B</span><span class="p">{}};</span>
<span class="err"> </span> <span class="n">b</span><span class="p">.</span><span class="n">foo</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>On the other hand, we can call non-const functions on locally initialized objects or on function parameters.</p>

<p>In case a function has two overloaded versions where one is <code class="language-plaintext highlighter-rouge">const</code> and the other is not, the compiler will choose which one to call based on whether the object itself is const or not.</p>

<p>The feature of <code class="language-plaintext highlighter-rouge">const</code> functions is something you should use all the time. Making the function <code class="language-plaintext highlighter-rouge">const</code> is <em>meaningful</em>. It helps the compiler to use optimizations and in addition, it clarifies the intent of the author. It shows the reader that if he calls such a function it will not have any effect on the members’ state.</p>

<p>Use it without moderation.</p>

<h2 id="const-variables"><code class="language-plaintext highlighter-rouge">const</code> variables</h2>

<p>If you declare a local variable <code class="language-plaintext highlighter-rouge">const</code>, you simply mark it immutable. It should never ever change its value. If you still try to modify it later on, you’ll get a compilation error. For global variables, this is rather useful, as otherwise, you have no idea who can modify their value. Of course, you should not use global variables and then you don’t face the problem…</p>

<p>Those global <code class="language-plaintext highlighter-rouge">const</code>s can introduce coupling among your classes or even components that you should avoid otherwise. You might even face the static initialization order fiasco, but this a problem for another day…</p>

<p>Otherwise, declaring variables as <code class="language-plaintext highlighter-rouge">const</code> also helps the compiler to perform some optimizations. Unless you explicitly mark a variable <code class="language-plaintext highlighter-rouge">const</code>, the compiler will not know (at least not for sure) that the given variable should not change. Again this is something that we should use whenever it is possible.</p>

<p>In real life, I find that we tend to forget the value making variables const, even though there are <a href="https://youtu.be/zBkNBP00wJE?t=1614">good examples at conference talks</a> and it really has no bad effect on your code, on maintainability.</p>

<p>This is such an important idea that in Rust, all your variables are declared as <code class="language-plaintext highlighter-rouge">const</code>, unless you say they should be mutable.</p>

<p>We have no reason not to follow similar practices.</p>

<p>Declare your local variables <code class="language-plaintext highlighter-rouge">const</code> if you don’t plan to modify them. Regarding global variables, well, avoid using then, but if you do, also make them <code class="language-plaintext highlighter-rouge">const</code> whenever possible.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Today, we started a new series about when and how to use the <code class="language-plaintext highlighter-rouge">const</code> keyword in C++. In this episode, we learned about <code class="language-plaintext highlighter-rouge">const</code> local/global variables and <code class="language-plaintext highlighter-rouge">const</code> functions. They come for free and even let the compiler to make some optimizations. At the same time, they increase the readability of your code. Use them without moderation.</p>

<p>On the other hand, I’ve never simply said variables. It’s because not the same considerations apply to member variables.</p>

<p>Stay tuned, next time we’ll learn about whether having <code class="language-plaintext highlighter-rouge">const</code> member variables is a good idea or not.</p>
:ET